/*! vizuly 05-06-2017 */
vizuly.viz.radial_progress=function(a){function b(){k=f.selection.append("svg").attr("id",f.id).style("overflow","visible").attr("class","vizuly"),r=vizuly.core.util.getDefs(h),m=k.append("rect").attr("class","vz-background"),l=k.append("g").attr("class","vz-radial_progress-viz"),n=l.append("g").attr("class","vz-radial_progress-plot"),o=n.append("rect").attr("class","vz-plot-background"),p=n.append("g").attr("class","vz-radial_progress-arc-plot"),q=n.append("g").attr("class","vz-radial_progress-label-plot"),n.on("mouseover",function(){f.dispatch.mouseover(this)}).on("mouseout",function(){f.dispatch.mouseout(this)}).on("click",function(){f.dispatch.click(this)}),f.dispatch.initialize()}function c(){h.validate(),i=vizuly.core.util.size(f.margin,f.width,f.height),j=f.startAngle==f.endAngle?360:f.startAngle>f.endAngle?360-(f.startAngle-f.endAngle):j=f.endAngle-f.startAngle;var a=f.startAngle*s,b=Math.floor(f.data/(f.max-f.min))+1,c=Math.min(f.radius*f.arcThickness,.75*f.radius/b);t=[];for(var d=0;b>d;d++){var e={},g=d3.svg.arc();g.outerRadius(f.radius-c*d),g.innerRadius(f.radius-c*(d+1)),g.cornerRadius(c*f.capRadius/2),e.arc=g,e.startAngle=a,console.log("start angle = "+e.startAngle);var k=f.data/(f.max-f.min)-d;e.endAngle=k>1?j*s+a:k*j*s+a,t.push(e)}u.outerRadius(f.radius).cornerRadius(c*f.capRadius/2).innerRadius(f.radius-c*t.length).startAngle(f.startAngle*s).endAngle((f.startAngle+j)*s),f.dispatch.measure()}function d(){c(),k.attr("width",f.width).attr("height",f.height),m.attr("width",f.width).attr("height",f.height),n.style("width",i.width).style("height",i.height).attr("transform","translate("+i.left+","+i.top+")"),p.attr("transform","translate("+i.width/2+","+i.height/2+")");var a=n.selectAll(".vz-radial_progress-back-circle");0==a[0].length&&(a=p.append("circle").attr("class","vz-radial_progress-back-circle")),a.attr("r",f.radius);var b=n.selectAll(".vz-radial_progress-track");0==b[0].length&&(b=p.append("path").attr("class","vz-radial_progress-track")),b.attr("d",u);var d=q.selectAll(".vz-radial_progress-label").data([f.data]);d.enter().append("text").attr("class","vz-radial_progress-label").style("text-anchor","middle"),d.exit().remove(),d.attr("x",i.width/2).attr("y",i.height/2).text(function(a,b){return f.label(a,b)});var g=p.selectAll(".vz-radial_progress-arc").data(t);g.enter().append("path").attr("class","vz-radial_progress-arc"),g.exit().remove(),g.transition().duration(f.duration).call(e),f.dispatch.update()}function e(a){a.attrTween("d",function(a){var b=d3.interpolate(a.startAngle,a.endAngle);return function(c){return a.endAngle=b(c),f.dispatch.tween(h,c),a.arc(a)}})}var f={},g={data:null,margin:{top:"10%",bottom:"7%",left:"8%",right:"7%"},duration:500,width:300,height:300,radius:150,min:0,max:1,label:function(a,b){return a},capRadius:0,startAngle:180,endAngle:180,arcThickness:.05},h=vizuly.core.component(a,f,g,["tween"]);h.type="viz.chart.radial_progress";var i,j,k,l,m,n,o,p,q,r,s=Math.PI/180,t=[],u=d3.svg.arc();return b(),h.update=function(){return d(),h},h};